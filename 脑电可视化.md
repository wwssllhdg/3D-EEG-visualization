## **基于球面插值的脑电功率谱动态可视化** 

综合思路：

1. **数据预处理**：

   **平均参考（Rereferencing）**：去除公共噪声，提高信号质量。

   **数据格式（7, 21, 104000）**：

   7：不同的试验或时间段

   21：电极数

   104000：时间点

2. **频谱分析**

   **小波变换（Wavelet Transform）**：提取 δ、θ、β 等频段的功率和频率信息。

   获取频率和功率：

   对 **每个电极（21个）** 进行 **小波变换**，得到 **时频表示**（即每个时间点的功率和频率）。

   计算 不同频段的功率

   例如：

   **δ 波 (0.5-4Hz)**

   **θ 波 (4-8Hz)**

   **α 波 (8-12Hz)**

   **β 波 (12-30Hz)**

   **γ 波 (30-100Hz)**

3. **脑皮层映射**：

   采用 **球面样条插值（Spherical Spline Interpolation）**，将 21 个电极的功率扩展到整个脑皮层。

   **颜色映射**（蓝-绿-红）：表示 **不同频率波段**。

   **不透明度/亮度**：表示 **功率大小**，功率越大，颜色越亮或更不透明。

   **弥散效果**：采用 **高斯核平滑或插值** 使高功率区域扩散。

4. **时序动态展示（ANARI 可视化）**：

   设定时间步长。

   更新脑皮层颜色。

   可视化要求：可视化不仅仅是“把数据画出来”，而是要让数据的不同属性在视觉上体现出有意义的联系 

### 数据预处理

**数据特点回顾：**

1. EEG 帽来自 Neuroscan 公司的 64 导布线，但实际采集到的有效脑电通道有 62 个（不含独立参考和 M1/M2（双乳突）） 

2.  Monopolar Montage(单极记录)，脑电帽上有一个**独立**的参考电极，位置在 Cz 和 CPz 之间，不属于 10-20 系统常规命名，也不在 62 个通道的名单中 

3.  现在拿到的数据已经是 (7, 62, 104000) 的三维矩阵（7 块数据，62 个通道，104000 个时间点（8m40s*200）520 *  200 = 104000）,已经下采样到200Hz，并通过（0.1-99）带通滤波器进行滤波 

   **脑电信号格式**

   脑电信号一般有两种montage格式，bipolar（双极记录）和monopolar（单极记录），bipolar的脑电数据比如CHB-MIT(常用于癫痫研究)数据集。

   **电极和通道的区别**

   电极和通道不是一个概念，一个通道一般表示两点电位差（双极记录），也存在表示单点电压的情况（单极记录）

   ![1737889132836](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\1737889132836.png)



**数据处理选择:**

1.平均参考（Average Reference）

 平均参考是EEG 领域最常用的“标准化”操作之一 

取所有电极的电压的平均值作为参考电压，逐个电极作差（原始通道信号 - 平均值）得到新的单极电压， 我们的62通道电极系统电极分布均匀且数量足够多，并且已经经过了降噪滤波，降低了脏电极的影响，平均参考能较好地近似“头皮整体平均电位”，



2.REST（Reference Electrode Standardization Technique）

在一个大脑或头皮传导模型中，假设有一个“零电位点”或“无限远参考”。

采集到的原始 EEG（无论参考是什么）都可以通过求解正则方程或矩阵运算，推算出对应“零参考”下的电极电位。

这个过程会综合利用电极位置、头皮/头骨/脑组织的导电特性等参数（越精确的模型，转换效果理论上越好）。

可以逼近真正的“零电位”，有助于源定位，相较于平均参考更精准，但是实现相对复杂，算法偏复杂，对模型的精度敏感，实现复杂，暂时不考虑。

论文参考：

**Yao, D. (2001).** A method to standardize a reference of scalp EEG recordings to a point at infinity. *Physiological Measurement*, 22, 693-711.

**Liu, Q., et al. (2021).** REST-revisited: A comprehensive evaluation of reference electrode standardization techniques for EEG analysis. *NeuroImage*, 237, 118165.



**数据映射关系：**

10-20电极系统（23-channel）

![1738416015736](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\1738416015736.png)

62通道电极系统

<img src="C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\1738415008110.png" alt="1738415008110" style="zoom:80%;" />

对应关系（21-channel）

<img src="C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\1738416439895.png" alt="1738416439895" style="zoom:50%;" />



数据处理：

提取新矩阵（取第一个矩阵的第一分钟 60 * 200 = 12000）

![1739510566631](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\1739510566631.png)

### 频谱分析 

利用小波变换，将每个电极的混合脑电波，划分为五种波

**选择原因**

信号处理领域，时频分析中存在的问题：由海森堡不确定性原理决定，时间分辨率和频率分辨率之间存在一种“权衡关系”，二者无法同时达到完美，如果想要提升时间分辨率，必须牺牲频率分辨率，反之亦然。

![1739103610368](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\1739103610368.png)

时间分辨率：分辨信号中时间点变化的能力，在脑电波中，时间分辨率高意味着可以精确捕捉到某个事件（比如癫痫发作）发生的具体时间

频率分辨率：分辨信号中频率成分的能力，在脑电波中，频率分辨率高意味着可以区分不同频段（比如Delta波和theta波）的具体频率

小波变换很好的平衡了这一问题，通过一组符合特定要求的小波函数（可自定义），而不是利用基础的正余弦函数，可以根据信号的特性动态调整时间和频率分辨率，针对高频信号采用时间分辨率高的函数，针对低频信号，采用频率分辨率高的函数

**高频信号**（如快速变化的信号）：使用**短时间窗口**（时间分辨率高），捕捉信号的快速变化。

**低频信号**（如缓慢变化的信号）：使用**长时间窗口**（频率分辨率高），捕捉信号的整体趋势。

傅里叶变换：挤压时间获取频率信息，忽略了时间要素，仅仅区分了频率

**处理流程**

选择小波函数并设置对应参数  ----->  逐个电极进行小波变换并计算不同频率对应的功率

![1739510554348](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\1739510554348.png)

**小波函数选择**： cmor1.5-1.0 ，Morlet小波是小波变换中最常用于EEG分析的一个小波，作为一个复数的小波，结合了正弦波和高斯窗函数。

1.5:带宽，控制小波的宽度，带宽决定了小波的时间和频率分辨率，带宽越小，频率分辨率越高，时间分辨率越低，反之亦然。

1.0:中心频率，表示小波的频率分布的中心大约在1Hz处

2，128:尺度参数，尺度与频率是反比的关系，尺度越大，频率越低。126个尺度可以覆盖从低频到高频的广泛范围。选择126个尺度（2到127）可确保捕捉到多种频率，适应EEG信号的不同频率成分。

选择原因：

奈奎斯特定理： 采样率至少要大于信号最高频率分量的两倍，以避免混叠并确保信号无失真还原 

之前降采样至200hz, 最大可解析频率为100 Hz , 信号频率范围实际在 **0 - 100 Hz** 之间 ， 小波变换的 **频率轴（频带划分）要与采样率匹配**，否则可能分析出超出信号频带的错误结果 

<img src="C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\1739184872499.png" alt="1739184872499" style="zoom:50%;" />

在 **采样率 200 Hz** 限制下， scales = np.arange(2, 128) 主要覆盖了 **1.56 Hz ~ 100 Hz** 这个范围 



**计算小波功率**

1.计算小波系数的幅度

2.计算幅度的平方，这表示在某个频率和时间点上的功率。

3.对指定频段内的所有时间点计算平均功率

![1739184227987](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\1739184227987.png)

### **脑皮层映射**

目的：将离散的电极数据通过球面插值扩展到连续的脑皮层表面，并根据频段功率数据进行颜色映射和透明度调整

 脑电数据的映射需要考虑脑皮层的**结构特性**、**空间一致性**以及**信号传播特性**等因素，而不仅仅是空间距离

方法选择：

 1.**球面插值（Spherical Interpolation）**

线性插值： 假设两个已知数据点之间的变化是线性的（即按照直线变化），然后根据这个假设来计算未知点的值 

**为什么适合**：脑皮层本身可以看作一个球面，因此球面插值能够更自然地适应这种结构。例如，可以考虑使用球面线性插值（SLERP）方法，这在大脑皮层表面插值非常合适，因为它在球面上按弧线插值，能够保留空间结构的平滑性。

**如何做**：首先，确定每个电极在脑皮层网格上的投影（即将电极位置映射到脑皮层表面）。然后，在电极间应用球面插值，而不是简单的平面距离加权。

**2.基于脑皮层拓扑的插值方法**

**为什么适合**：脑皮层是一个复杂的三维网格结构，采用与脑皮层的几何结构相关的插值方法可以更准确地映射脑电信号。你可以利用脑皮层的拓扑信息（如球面样条插值）进行插值，避免单纯基于电极间距离的插值。

**如何做**：通过对脑皮层网格的拓扑结构进行建模（例如，使用球面样条插值），可以确保插值不仅在空间上保持一致性，同时也能捕捉到脑皮层的生物学特性。

3.**有限元方法（FEM）或解算器**

**为什么适合**：有限元方法（FEM）能够将大脑的复杂电场分布纳入计算，并且考虑到不同区域的电流和电压分布。FEM在解决脑电信号传播和映射问题时非常强大，因为它考虑到脑组织的物理性质。

**如何做**：你可以将大脑网格和电极数据与FEM模型结合，进行电流传播模拟，计算脑电信号在脑皮层的传播，并得到更加精准的信号映射。

**4.源定位**

 目标是从多个电极位置测量的信号中估算出大脑内的电活动源的位置和强度 



实践：

1.利用球面线性插值算法获取五种波的功率矩阵

![1739521042185](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\1739521042185.png)

 2.进行颜色和不透明度映射

**颜色不透明度映射规律**：

**每个频段对应一种颜色**：

Delta波：蓝色

Theta波：绿色

Alpha波：黄色

Beta波：橙色

Gamma波：红色

**功率值决定最终的颜色**：

频段的功率值越大，该频段对应的颜色权重增加，最终颜色是全部颜色的加权叠加

**透明度由总功率决定**：

总功率越高，不透明度越低

**先将每个电极对应的不同频段的功率映射到脑皮层的每一个点，让每个点都有自己的五种波的功率数据，然后再进行颜色映射** 

![1739521081542](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\1739521081542.png)









### 时序动态展示

弥散可视化预期结果：

![1739520914729](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\1739520914729.png)

![1739519404455](C:\Users\Lenovo\AppData\Roaming\Typora\typora-user-images\1739519404455.png)

### Other

**脑电深度学习**：

EEGNet**模型，用于研究脑电数据，具有较高的泛化性  **NeuroKit2 包，用于生理信号分析**

提取三维EEG特征并归一化

1.特征数据SHAPE的正确输入:

当我们拿到一个EEG数据，无论这个数据是csv,.m,.np的普通格式；还是BDF,GDF等几十种这样的特殊格式，它通常是**C*T**的shape(channel *   Time points ，一段时间内的采样点，采样频率 * 数据记录时间),我们想要使用这个数据，首先需要对数据进行预处理，然后根据自己的需求，对预处理后的数据进行特征提取或者直接原始数据作为输入（目前的脑电深度学习论文数据处理选择是一半一半）